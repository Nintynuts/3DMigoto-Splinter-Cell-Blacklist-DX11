// God Rays Source (1)

cbuffer CB_PS_GodRaysSource : register(b7)
{
	float4 cScreenPos : packoffset(c0);
}

SamplerState sSceneTexPoint_s : register(s0);
SamplerState sDepthMap_s : register(s1);
Texture2D<float4> sDepthMap : register(t0);
Texture2D<float4> sSceneTexPoint : register(t1);

// 3Dmigoto declarations
#define cmp -
Texture1D<float4> IniParams : register(t120);
Texture2D<float4> StereoParams : register(t125);

void main(
	float4 v0 : SV_Position0,
	float4 v1 : TEXCOORD0,
	out float4 o0 : SV_Target0)
{
	float4 r0;

	float4 stereo = StereoParams.Load(0);
	
	r0.x = sDepthMap.Sample(sDepthMap_s, v1.zw).x;
	r0.y = cmp(63999 >= r0.x);
	r0.x = -cScreenPos.w + r0.x;
	r0.y = r0.y ? 1.000000 : 0;
	r0.x = r0.y * r0.x + 9.99999975e-005;
	r0.x = cmp(r0.x < 0);
	if (r0.x != 0) discard;
	o0.xz = float2(0,0);
	r0.xyzw = sSceneTexPoint.Sample(sSceneTexPoint_s, v1.xy).xyzw;
	o0.y = dot(r0.xyz, float3(0.300000012,0.600000024,0.100000001));
	o0.w = r0.w;
	return;
}