// God Rays Compose (4)

cbuffer CB_PS_GodRaysCompose : register(b7)
{
	float4 cColor : packoffset(c0);
}

SamplerState sGodRays_s : register(s0);
Texture2D<float4> sGodRays : register(t0);

// 3Dmigoto declarations
#define cmp -
Texture1D<float4> IniParams : register(t120);
Texture2D<float4> StereoParams : register(t125);

void main(
	float4 v0 : SV_Position0,
	float4 v1 : TEXCOORD0,
	out float4 o0 : SV_Target0)
{
	float4 r0,r1;

	float4 stereo = StereoParams.Load(0);
	v1.z -= stereo.x / 2;

	r0.x = sGodRays.Sample(sGodRays_s, v1.zw).y;
	r0.xyzw = cColor.xyzw * r0.xxxx;
	r1.x = dot(r0.xyz, float3(1,1,1));
	o0.xyzw = r0.xyzw;
	r0.x = cmp(-r1.x >= 0);
	if (r0.x != 0) discard;
	return;
}