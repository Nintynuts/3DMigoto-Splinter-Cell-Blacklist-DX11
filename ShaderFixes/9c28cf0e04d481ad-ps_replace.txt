// GUI - Video

cbuffer CB_PS_SimpleVCTexMux : register(b7)
{
	float4x3 mat : packoffset(c0);
	float4 uv[4] : packoffset(c3);
}

SamplerState texX_s : register(s0);
SamplerState texY_s : register(s1);
SamplerState texZ_s : register(s2);
Texture2D<float4> texX : register(t0);
Texture2D<float4> texY : register(t1);
Texture2D<float4> texZ : register(t2);

#include "3Dmigoto.hlsl"

void main(
	float4 v0 : SV_Position0,
	float4 v1 : TEXCOORD0,
	float2 v2 : TEXCOORD1,
	out float4 o0 : SV_Target0)
{
	float4 r0,r1,r2;
	
	r0.w = 1;
	r1.xy = v2.xy * uv[0].xy + uv[0].zw;
	
	if (ini(x,3)) // is_title_screen
	{
		r1.x -= separation * gui_depth / 500;
		// Wrap around
		if (r1.x > 1)
			r1.x = 2-r1.x;
		else
			r1.x = abs(r1.x);
	}
	r1.x = texX.Sample(texX_s, r1.xy).x;
	r2.xy = v2.xy * uv[1].xy + uv[1].zw;
	r1.y = texY.Sample(texY_s, r2.xy).x;
	r2.xy = v2.xy * uv[2].xy + uv[2].zw;
	r1.z = texZ.Sample(texZ_s, r2.xy).x;
	r1.w = 1;
	r0.xyz = mul(r1, mat);
	o0 = v1 * r0;
	return;
}